---
version: 2
jobs:
  build:
    working_directory: ~/proxmox
    docker:
      - image: circleci/ruby:2.5.7-buster # Puppet 6 is packaged bundled with that version of ruby
    steps:
      - checkout
      - run:
          name: Install latest puppet 6
          command: gem install puppet
      - run: 
          name: Get Ruby/Gem/Puppet versions for this run
          command: ruby --version && echo -n 'gem ' && gem --version && echo -n 'puppet ' && puppet --version
#      - run: 
#          name: Puppet files syntax check
#          command: for file in $(find manifests/ -name '*.pp'); do echo $file; puppet parser validate $file || exit 1; done
#      - run: 
#          name: ERB files syntax check
#          command: for file in $(find templates/ -name "*.erb"); do echo $file; erb -P -x -T - "${file}" || exit 1; done
#      - run: 
#          name: Shell scripts syntax check
#          command: for file in $(find files/ -name "*.sh"); do echo $file; bash -n $file || exit 1; done
#      - run: 
#          name: Custom facts syntax check
#          command: for file in $(find lib/facter -name "*.rb"); do echo $file; ruby -c $file || exit 1; done
#      - run: 
#          name: Check for non-printable characters
#          command: grep -I -H -P -n "[\xa0]" --color=yes -r * || tr '\302\102' 'X'
#      - run: 
#          name: Install puppet-lint
#          command: gem install puppet-lint
#      - run: 
#          name: Puppet lint; only clean code in our Org ;-)
#          command: ret=0; for file in $(find manifests/ -name '*.pp'); do echo $file; puppet-lint --fail-on-warnings --no-140chars-check $file || ret=1; done; exit $ret
#